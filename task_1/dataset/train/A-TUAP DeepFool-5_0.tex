%Input
$ X $: The set of data points. \\
$ \hat{k} $: The classifier function. \\
$ \xi $: The desired $\ell_p$ norm of the perturbation. \\
$ \delta $: The desired accuracy on perturbed samples. \\
$ t $: The target class label. \\
$ \text{Err}(Xv) $: The error rate on the perturbed data points $ Xv $. \\
$ x_i $: A data point in $ X $. \\
$ \Delta v_i $: The minimal perturbation required to change the classification of $ x_i + v $. \\
$ \| \cdot \|_2 $: The $\ell_2$ norm. \\
$ P_{p, \xi} $: The projection operator that projects $ v $ onto the $\ell_p$ ball of radius $ \xi $.

%Output
Targeted universal perturbation vector $ v $.

%Formula
Targeted Universal Adversarial Perturbations (TUAP) Using DeepFool:

1. Initialize the perturbation vector $v \leftarrow 0$.

2. While the error rate on the perturbed data is less than or equal to $1 - \delta$:
\[
\text{Err}(Xv) \leq 1 - \delta
\]

3. For each data point $x_i \in X$, do:
    - If the classifier's prediction for $x_i + v$ is not the target class $t$:
    \[
    \hat{k}(x_i + v) \neq t
    \]
        - Compute the minimal perturbation $\Delta v_i$ that changes the classification of $x_i + v$ to the target class $t$:
        \[
        \Delta v_i \leftarrow \arg \min_{r} \|r\|_2 \quad \text{s.t.} \quad \hat{k}(x_i + v + r) = t
        \]
        - Update the perturbation:
        \[
        v \leftarrow P_{p, \xi}(v + \Delta v_i)
        \]

4. Repeat the process until the error rate condition is no longer met.

Return the final targeted universal perturbation vector is:
\[
v
\]

%Explanation
This attack combines a universal perturbation strategy with DeepFool's approach for computing minimal perturbations to push data points toward a targeted class, while also maintaining control over the magnitude of the perturbation using the $\ell_p$ norm constraint.
Initialization: Initialize the universal perturbation vector $ v $ to 0. \\
Iteration Loop: Continue iterating while the error rate on the perturbed data points $ \text{Err}(Xv) $ is less than or equal to $ 1 - \delta $. \\
Perturbation Update for Each Data Point: For each data point $ x_i $ in the set $ X $:
 If the classifier's prediction for $ x_i + v $ is not equal to the target class $ t $, then compute the minimal perturbation $ \Delta v_i $ required to change the classification of $ x_i + v $ to the target class $ t $. This involves finding the smallest perturbation $ r $ such that the classifier's prediction for $ x_i + v + r $ matches the target class $ t $. \\
Update the perturbation $ v $ by adding $ \Delta v_i $ and then projecting the result onto the $\ell_p$ ball of radius $ \xi $ using the projection operator $ P_{p, \xi} $.
